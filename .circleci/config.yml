version: 2.1
orbs:
    heroku: circleci/heroku@1.2.4
jobs:
    build:
        machine:
            image: ubuntu-2004:202010-01
        steps:
            - checkout
            - run:
                name: Build and push Docker image to Heroku
                command: |
                    sudo curl https://cli-assets.heroku.com/install.sh | sh
                    HEROKU_API_KEY=${HEROKU_TOKEN} heroku container:login
                    HEROKU_API_KEY=${HEROKU_TOKEN} heroku container:push -a ${HEROKU_APP_NAME} ${HEROKU_PROCESS_TYPE}
                    HEROKU_API_KEY=${HEROKU_TOKEN} heroku container:release -a ${HEROKU_APP_NAME} ${HEROKU_PROCESS_TYPE}
